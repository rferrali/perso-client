<div class="card">
  <div class="card-body">
    <div *ngIf="!editMode; then displayBlock; else editBlock">

    </div>
  </div>
</div>

<ng-template #displayBlock>
  <div class="d-flex justify-content-between">
    <div>
      <span><strong style="font-weight: 500;">{{ paper.title }}</strong> </span>
      <span *ngIf="paper.coauthors.length > 0">, with </span>
      <app-people-edit [people]="paper.coauthors" [editMode]="editMode" [peopleForm]="coauthors"
        [sortablePeople]="sortableCoauthors" [otherPeople]="otherAuthors">
      </app-people-edit>
    </div>
    <div>
      <button *ngIf="!disableEdit && ! auth.preview" class="btn btn-sm btn-dark" type="button"
        (click)="enableEdit()">
        <i class="fa fa-edit"></i>
      </button>
      <button *ngIf="deleteMode  && ! auth.preview" class="btn btn-sm btn-danger btn-outline"
        type="button" (click)="onDelete(paper)">
        <i class="fa fa-trash"></i>
      </button>
    </div>
  </div>
  <div *ngIf="paper.status" class="mb-2" [innerHtml]="paper.status"></div>
  <div *ngIf="paper.keywords.length > 0" class="clearfix mb-2">
    <app-keywords-edit [editMode]="editMode" [keywords]="paper.keywords" [kFilter]="kFilter">
    </app-keywords-edit>
  </div>

  <div class="clearfix">
    <span class="float-left pull-left">
      <a class="btn btn-sm btn-primary mr-1" href="javascript:;" (click)="showAbstract = !showAbstract"
        [eventTracker]='{"category":"button","action":"abstract: " + paper.title}'>
        <i class="fa fa-plus"></i> Abstract</a>
      <button class="btn btn-sm btn-primary mr-1" app-citation-export [citation]="paper.citation"
        *ngIf="paper.citation"></button>
    </span>
    <app-buttons [btns]="btns" [obtns]="paper.buttons" [sortableButtons]="sortableButtons">
    </app-buttons>
  </div>
  <p class="card-text mt-2" [collapse]="!showAbstract">
    {{ paper.abstract }}
  </p>
</ng-template>



<ng-template #editBlock>
  <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
    <h5 class="card-title">
      <input class="form-control form-control-lg" type="text" formControlName="title" placeholder="Title" required>
      <div *ngIf="editForm.get('title').invalid && editForm.get('title').touched" class="bad-feedback">
        All good stories start with a great title. This is a good story.
      </div>

    </h5>
    <div class="form-group">
      <input type="text" class="form-control" formControlName="status" placeholder="Status">
    </div>
    <div class="form-group">
      <input type="text" class="form-control" formControlName="citation" placeholder="Citation">
    </div>

    <div class="clearfix">
      <span class="mr-1 float-left pull-left">With</span>
      <app-people-edit [people]="paper.coauthors" [editMode]="editMode" [peopleForm]="coauthors"
        [sortablePeople]="sortableCoauthors" [otherPeople]="otherAuthors">
      </app-people-edit>
    </div>

    <div class="clearfix mb-2">
      <app-keywords-edit [editMode]="editMode" [keywords]="paper.keywords" [keywordsForm]="keywords"
        [allKeywords]="allKeywords">
      </app-keywords-edit>
    </div>

    <div class="clearfix">
      <span class="mr-1 float-left pull-left">
        <a class="btn btn-sm btn-primary" href="javascript:;" (click)="showAbstract = !showAbstract">
          <i class="fa fa-plus"></i> Abstract</a>
      </span>
      <app-buttons [btns]="btns" [obtns]="paper.buttons" [sortableButtons]="sortableButtons">
      </app-buttons>
    </div>


    <div class="form-group mt-3" [collapse]="!showAbstract">
      <textarea class="form-control" rows=5 formControlName="abstract" placeholder="Abstract"></textarea>
    </div>

    <div class="mt-3 clearfix">
      <div class="btn-group">
        <button class="btn btn-outline-primary" type="button" (click)="onCancel()">
          <i class="fa fa-times"></i> Cancel
        </button>
        <button class="btn btn-outline-primary" type="button" (click)="onRestore()">
          <i class="fa fa-history"></i> Restore
        </button>
        <button class="btn btn-primary" type="submit" [disabled]="editForm.invalid">
          <i class="fa fa-save"></i> Save
        </button>
      </div>
    </div>

  </form>

</ng-template>